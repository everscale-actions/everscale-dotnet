<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <PackageReference Include="ch1seL.MSBuildGzTool" Version="1.0.9">
      <PrivateAssets>All</PrivateAssets>      
    </PackageReference>
  </ItemGroup>
  
  <PropertyGroup>
    <_SDKVersionDenormalized>$([System.String]::Copy('$(SDKVersion)').Replace('.', '_'))</_SDKVersionDenormalized>
    
    <_TonLibDownloadUrlWin>http://sdkbinaries-ws.tonlabs.io/tonclient_$(_SDKVersionDenormalized)_win32_dll.gz</_TonLibDownloadUrlWin>
    <_TonLibDownloadUrlLinux>http://sdkbinaries-ws.tonlabs.io/tonclient_$(_SDKVersionDenormalized)_linux.gz</_TonLibDownloadUrlLinux>
    <_TonLibDownloadUrlMacOS>http://sdkbinaries-ws.tonlabs.io/tonclient_$(_SDKVersionDenormalized)_darwin.gz</_TonLibDownloadUrlMacOS>
  </PropertyGroup>

  <Target Name="DownloadContentFiles" BeforeTargets="CoreCompile">
    <MakeDir Directories="$(MSBuildThisFileDirectory)..\runtimes\win-x64\native\" />    
    <DownloadFile SourceUrl="$(_TonLibDownloadUrlWin)" DestinationFolder="$(MSBuildThisFileDirectory)..\downloads\" DestinationFileName="tonclient_win32_dll.gz">
      <Output TaskParameter="DownloadedFile" ItemName="None" />
    </DownloadFile>    
    <UnGzip SourceFile="$(MSBuildThisFileDirectory)..\downloads\tonclient_win32_dll.gz" DestinationFile="$(MSBuildThisFileDirectory)..\runtimes\win-x64\native\tonclient.dll" />
    
    <MakeDir Directories="$(MSBuildThisFileDirectory)..\runtimes\linux-x64\native\" />    
    <DownloadFile SourceUrl="$(_TonLibDownloadUrlLinux)" DestinationFolder="$(MSBuildThisFileDirectory)..\downloads\" DestinationFileName="tonclient_linux.gz">
      <Output TaskParameter="DownloadedFile" ItemName="None" />
    </DownloadFile>
    <UnGzip SourceFile="$(MSBuildThisFileDirectory)..\downloads\tonclient_linux.gz" DestinationFile="$(MSBuildThisFileDirectory)..\runtimes\linux-x64\native\libtonclient.so" />
    
    <MakeDir Directories="$(MSBuildThisFileDirectory)..\runtimes\osx-x64\native\" />    
    <DownloadFile SourceUrl="$(_TonLibDownloadUrlMacOS)" DestinationFolder="$(MSBuildThisFileDirectory)..\downloads\" DestinationFileName="tonclient_darwin.gz">
      <Output TaskParameter="DownloadedFile" ItemName="None" />
    </DownloadFile>
    <UnGzip SourceFile="$(MSBuildThisFileDirectory)..\downloads\tonclient_darwin.gz" DestinationFile="$(MSBuildThisFileDirectory)..\runtimes\osx-x64\native\libtonclient.dylib" />
  </Target>
    
</Project>