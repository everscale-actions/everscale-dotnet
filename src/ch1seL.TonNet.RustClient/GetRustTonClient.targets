<Project>
    <ItemGroup>
        <PackageReference Include="ch1seL.MSBuildGzTool" Version="1.0.9" />
    </ItemGroup>

    <PropertyGroup>
        <IsWin Condition="$([MSBuild]::IsOSPlatform('Windows'))">true</IsWin>
        <IsLinux Condition="$([MSBuild]::IsOSPlatform('Linux'))">true</IsLinux>
        <IsOs Condition="$([MSBuild]::IsOSPlatform('OSX'))">true</IsOs>
        
        <LibPlatform Condition="'$(IsWin)' == 'true'">win32_dll</LibPlatform>
        <LibPlatform Condition="'$(IsLinux)' == 'true'">darwin</LibPlatform>
        <LibPlatform Condition="'$(IsOs)' == 'true'">linux</LibPlatform>
        
        <TonLibLocalPath Condition="'$(IsWin)' == 'true'">$(MSBuildThisFileDirectory)tonclient.dll</TonLibLocalPath>
        <TonLibLocalPath Condition="'$(IsLinux)' == 'true'">$(MSBuildThisFileDirectory)libtonclient.so</TonLibLocalPath>
        <TonLibLocalPath Condition="'$(IsOs)' == 'true'">$(MSBuildThisFileDirectory)libtonclient.dylib</TonLibLocalPath>        
    </PropertyGroup>
    
    <PropertyGroup>
        <SDKVersionDenormalized>$([System.String]::Copy('$(SDKVersion)').Replace('.', '_'))</SDKVersionDenormalized>
        <TonLibUrl>http://sdkbinaries-ws.tonlabs.io/tonclient_$(SDKVersionDenormalized)_$(LibPlatform).gz</TonLibUrl>
    </PropertyGroup>
    
    <Target Name="DownloadContentFiles" BeforeTargets="_CopyFilesMarkedCopyLocal">
        <DownloadFile SourceUrl="$(TonLibUrl)" DestinationFolder="$(MSBuildThisFileDirectory)" DestinationFileName="tonclient.gz">
            <Output TaskParameter="DownloadedFile" ItemName="Content" />
        </DownloadFile>        
        <UnGzip SourceFile="$(MSBuildThisFileDirectory)tonclient.gz" DestinationFile="$(TonLibLocalPath)" />
<!--        dotnet pack broken ??-->
<!--        <Delete Files="$(MSBuildThisFileDirectory)tonclient.gz" />-->
    </Target>

    <ItemGroup>
        <Content Include="$(TonLibLocalPath)">            
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>            
            <Visible>false</Visible>
        </Content>
        <None Remove="tonclient.gz" />
    </ItemGroup>
    
</Project>