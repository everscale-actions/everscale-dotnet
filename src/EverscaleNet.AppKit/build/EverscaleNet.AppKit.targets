<Project>

	<PropertyGroup>
		<EverDevTool Condition=" $(EverDevTool) == '' ">npx everdev@latest</EverDevTool>
		<SolCompilerVersion Condition=" $(SolCompilerVersion) == '' ">latest</SolCompilerVersion>
		<TVMLinkerVersion Condition=" $(TVMLinkerVersion) == '' ">latest</TVMLinkerVersion>
	</PropertyGroup>

	<ItemGroup>
		<Content Include="**\*.sol;**\*.tsol" />
	</ItemGroup>

	<Target Name="IncludeSolidityFiles" BeforeTargets="CompileSolidityContracts;GetCopyToOutputDirectoryItems">
		<ItemGroup>
			<SolAllFiles Include="**\*.sol;**\*.tsol" />
			<SolCompileFiles Include="**\*.sol;**\*.tsol" Exclude="**\interfaces\**;**\include\**;**\import\**;**\abstract\**;**\.solc_imports\**" />
		</ItemGroup>
	</Target>

	<Target Name="CompileSolidityContracts" Condition=" $(DoNotBuildContracts) == '' " Inputs="@(SolAllFiles)" Outputs="@(SolCompileFiles->'$(OutputPath)%(RelativeDir)%(Filename).tvc');@(SolCompileFiles->'$(OutputPath)%(RelativeDir)%(Filename).abi.json')" AfterTargets="Build">
		<Exec Command="$(EverDevTool) --version" />
		<Exec Command="$(EverDevTool) sol set -c $(SolCompilerVersion)" />
		<Exec Command="$(EverDevTool) sol version" />
		<Message Text="Building @(SolCompileFiles).. @(SolCompileFiles->'$(OutputPath)%(RelativeDir)%(Filename).tvc');@(SolCompileFiles->'$(OutputPath)%(RelativeDir)%(Filename).abi.json')" />
		<Exec Command="$(EverDevTool) sol compile %(Identity) -o @(SolCompileFiles->'$(OutputPath)%(RelativeDir)')" />
	</Target>

	<Target Name="GetCopyToOutputDirectoryTvcItems" BeforeTargets="GetCopyToOutputDirectoryItems">
		<ItemGroup>
			<CompiledTvcFiles Include="@(SolCompileFiles->'$(OutputPath)%(RelativeDir)%(Filename).tvc')">
				<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
				<TargetPath>%(RelativeDir)%(Filename).tvc</TargetPath>
			</CompiledTvcFiles>

			<CompiledAbiFiles Include="@(SolCompileFiles->'$(OutputPath)%(RelativeDir)%(Filename).abi.json')">
				<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
				<TargetPath>%(RelativeDir)%(Filename).abi.json</TargetPath>
			</CompiledAbiFiles>

			<FileWrites Include="@(CompiledTvcFiles->'%(FullPath)');@(CompiledAbiFiles->'%(FullPath)')" />

			<AllItemsFullPathWithTargetPath Include="@(CompiledTvcFiles->'%(FullPath)');@(CompiledAbiFiles->'%(FullPath)')" />
		</ItemGroup>
	</Target>

</Project>
